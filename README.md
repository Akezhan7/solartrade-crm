# README.md
# Solar Trade CRM

CRM-система для управления продажами солнечных электростанций и сопутствующего оборудования.

## Технологии

### Бэкенд
- Node.js
- NestJS
- Prisma ORM
- PostgreSQL
- JWT авторизация
- OpenAPI/Swagger для документации

### Фронтенд
- React
- TypeScript
- Material UI
- React Router
- Axios
- Chart.js

## Основные возможности

1. **Авторизация и аутентификация пользователей**
   - Поддержка ролей: администратор, менеджер, продажи
   - JWT-токены для безопасности

2. **Управление клиентами**
   - Создание, редактирование и удаление клиентов
   - Поддержка как физических лиц, так и компаний
   - Просмотр истории взаимодействий с клиентами

3. **Управление сделками**
   - Отслеживание статуса сделок
   - Расчет вероятности закрытия
   - Аналитика по сделкам
   - Иерархия статусов сделок

4. **Управление задачами**
   - Создание, назначение и отслеживание задач
   - Приоритеты и сроки выполнения
   - Напоминания о приближающихся сроках

5. **Дашборд с аналитикой**
   - Общая статистика по клиентам, сделкам и задачам
   - Графики выручки
   - Круговые диаграммы по статусам сделок
   - Списки активных задач и предстоящих сделок

6. **Интеграция с Telegram**
   - Уведомления о новых клиентах
   - Уведомления о новых сделках
   - Уведомления о новых задачах
   - Напоминания о приближающихся сроках

## Начало работы

### Требования
- Node.js 16+ 
- PostgreSQL
- npm или yarn

### Установка и запуск

1. Клонируйте репозиторий:
```
git clone https://github.com/yourusername/solar-trade-crm.git
cd solar-trade-crm
```

2. Для быстрого старта используйте скрипт инициализации:
```
init-and-start.bat
```

Или выполните шаги вручную:

3. Установите зависимости бэкенда:
```
cd backend
npm install
```

4. Настройте подключение к базе данных в файле `.env`:
```
DATABASE_URL="postgresql://postgres:password@localhost:5432/solar_crm?schema=public"
JWT_SECRET="your_secret_key"
JWT_EXPIRATION=86400
```

5. Выполните миграции и заполните базу тестовыми данными:
```
npx prisma generate
npx prisma migrate deploy
npx ts-node prisma/seed.ts
```

6. Запустите бэкенд:
```
npm run start:dev
```

7. Установите зависимости фронтенда:
```
cd ../frontend
npm install
```

8. Запустите фронтенд:
```
npm start
```

9. Откройте приложение в браузере: http://localhost:3000

### Учетные данные для входа

- **Администратор**: admin@solartrade.com / admin123
- **Менеджер**: manager@solartrade.com / manager123
- **Продавец**: sales@solartrade.com / sales123

## Структура проекта

```
solar-trade-crm/
├── backend/               # Бэкенд на NestJS
│   ├── prisma/            # Схемы и миграции Prisma
│   ├── src/               # Исходный код
│   └── test/              # Тесты
├── frontend/              # Фронтенд на React
│   ├── public/            # Статические файлы
│   └── src/               # Исходный код
├── docker/                # Docker-конфигурации
└── README.md              # Этот файл
```

## API документация

После запуска бэкенда, OpenAPI (Swagger) документация доступна по адресу:
http://localhost:3001/api/docs

## Полезные скрипты

- **init-and-start.bat** - Инициализация проекта и запуск
- **reset-database.bat** - Сброс и пересоздание базы данных с тестовыми данными
- **backend/scripts/db-update.bat** - Обновление схемы базы данных и миграций
- **backend/scripts/update-telegram.bat** - Настройка интеграции с Telegram
- **check-services.bat** - Проверка статуса всех компонентов системы

## Настройка базы данных PostgreSQL

### Установка и подключение
1. Убедитесь, что PostgreSQL установлен и запущен на вашей системе
2. Проверьте настройки подключения в файле `backend/.env`:
   ```
   DATABASE_URL="postgresql://postgres:1208@localhost:5432/solartrade"
   ```
3. При необходимости измените имя пользователя, пароль или порт

### Инициализация базы данных
Для автоматической инициализации базы данных используйте один из следующих скриптов:
- `init-and-start.bat` - полная инициализация проекта и запуск
- `reset-database.bat` - сброс и пересоздание базы данных с тестовыми данными
- `backend/scripts/db-update.bat` - обновление схемы базы без полного сброса

### Миграции Prisma
База данных управляется с помощью Prisma ORM. Доступны следующие команды (из директории `backend`):
- `npx prisma migrate dev` - создать новую миграцию при изменении схемы
- `npx prisma migrate deploy` - применить все миграции
- `npx prisma generate` - сгенерировать клиент Prisma
- `npx prisma studio` - открыть интерфейс для просмотра и редактирования данных

## Интеграция с Telegram

Для настройки интеграции с Telegram:
1. В разделе "Настройки" CRM введите токен вашего Telegram бота и ID чата
2. Токен можно получить у @BotFather в Telegram
3. ID чата можно узнать, добавив в чат бота @userinfobot
4. Нажмите "Тестировать" для проверки подключения

## Лицензия

MIT
